<import src="templates/shop-activities.wxml" />

<view bindtap="toggleMask">
    <view class="header">
        <view class="content-wrapper">
            <view class="avatar">
                <image src="{{supplier.logo}}"></image>
            </view>
            <view class="content">
                <view class="title">
                    <span class="name">{{supplier.name}}</span>
                </view>
                <view class="description"> {{supplier.intro}} </view>
                <view class="description"> {{supplier.address}} </view>
            </view>
        </view>
        <view class="bulletin-wrapper">
          <image src="../image/bulletin@2x.png" style="width:22px;height:12px;"></image>
          <span class="bulletin-text">"粥品香坊其烹饪粥料的秘方源于中国千年古法，在融和现代制作工艺，由世界烹饪大师屈浩先生领衔研发。坚守纯天然、0添加的良心品质深得消费者青睐，发展至今成为粥类的引领品牌。是2008年奥运会和2013年园博会指定餐饮服务商。"</span>
        </view>
        <view class="background">
            <image src="{{supplier.logo}}"></image>
        </view>
    </view>
    <!--head -->

    <view class="dishs">
        <view class="menu-wrapper">
            <scroll-view scroll-y="true">
                <view wx:for="{{supplier.dishcategories}}" class="menu-item border-1px {{toViewIndex==index ? 'active':''}}" bindtap="selectMenu" wx:for-index="dishcategoryindex">
                    <view class="text">
                        {{item.name}}
                    </view>
                </view>
            </scroll-view>
        </view>
        <scroll-view scroll-y="true" scroll-into-view="{{toView}}" scroll-with-animation="{{true}}" class="dishs-wrapper">
            <view class="dish-list dish-list-hook" wx:for="{{supplier.dishcategories}}" wx:for-item="dishcategory" wx:for-index="dishcategoryindex">
                <!--分类-->
                <view id="order{{dishcategoryid}}" class="title">
                    {{dishcategory.name}}
                </view>
                <view wx:for="{{dishcategory.dishs}}" class="dish-item" wx:for-item="dish" wx:for-index="dishindex">
                    <view class="icon">
                        <image src="{{dish.dishimage}}" style="width: 57px;height: 57px"></image>
                    </view>
                    <view class="content">
                        <view class="name">{{dish.name}}</view>
                        <view class="desc">{{dish.intro}}</view>
                        <view class="name">
                            <text class="count">月售{{dish.dishs}}</text>
                        </view>
                        <view class="price">
                            <view class="now">￥{{dish.dishattrs[0].pricetext}}</view>
                        </view>

                        <!--cartControl-->
                        <view class="cartControl-wrapper">
                            <view class="cartControl">
                                <view name="fade" wx:if="{{dish.dishattrs.length<=1}}">
                                    <image class="plus" wx:if="{{selection[dish.uniquekey]}}" src="/images/minus.png" data-dishindex="{{dishindex}}" data-dish="{{dish}}" catchtap="decreaseCart1"></image>
                                    <view class="cart-count" wx:if="{{selection[dish.uniquekey]}}">{{selection[dish.uniquekey]['quantity']}}</view>
                                    <image class="plus" src="/images/plus.png" data-dishindex="{{dishindex}}" data-dish="{{dish}}" catchtap="addCart1"></image>
                                </view>
                                 <view name="fade" wx:if="{{dish.dishattrs.length>1}}">
                                    <button data-dish="{{dish}}" class="choosespec" catchtap="choosespec" type="primary">选规格</button>
                                </view>
                            </view>
                        </view>
                    </view>
                </view>
            </view>
        </scroll-view>


        <view name="fade">
            <view class="list-mask" wx:if="{{cartShowClass=='block'}}" bindtap="toggleCartShow"></view>
        </view>
    </view>
</view>

<!--shopCart-->
<view class="shopCartContainer">
    <view class="shopCart">
        <view class="content" bindtap="toggleCartShow">
            <view class="content-left">
                <view class="logo-wrapper">
                    <view class="logo highlight">
                        <image class="gouwuche" src="/images/cart_fff.png" mode="widthFix" binderror="" bindload=""></image>
                    </view>
                    <view class="num" wx:if="{{totalCount> 0}}">{{totalCount}}</view>
                </view>
                <view class="price highlight">{{totalPriceDescription}}</view>
                <view class="desc"></view>
            </view>
            <view class="content-right" catchtap="pay" wx:if="{{totalPrice}}">
                <view class="pay enough">
                    去结算
                </view>
            </view>
        </view>
        <view class="shopcart-list" style="display:{{cartShowClass}}">
            <view class="list-header">
                <view class="title">购物车</view>
                <text class="empty" bindtap="empty">清空</text>
            </view>
            <view class="list-content">
                <view class="shopcart-dish" wx:for="{{selection}}">
                    <text class="name">{{item.dish.name}}</text>
                    <view class="price" wx:if="{{item.quantity}}">
                        <span>￥{{item.totaldescription}}</span>
                    </view>

                    <!--cartControl-->
                    <view class="cartControl-wrapper" style="bottom:10px;" wx:if="{{item.quantity}}">
                        <view class="cartControl" style="width:80px;">
                            <view name="fade">
                                <image class="plus" src="/images/minus.png" data-item="{{item}}" catchtap="decreaseCart2"></image>
                                <view class="cart-count">{{item.quantity}}</view>
                                <image class="plus" src="/images/plus.png" data-item="{{item}}" catchtap="addCart2"></image>
                            </view>
                        </view>
                    </view>
                    <!--cartControl-->
                </view>
            </view>
        </view>
    </view>
</view>

<template is="shop-activities" wx:if="{{showActivities}}" data="{{supplier: supplier}}" />
